<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Content Security Policy for XSS protection -->
    <!-- Note: 'unsafe-inline' and 'unsafe-eval' are required for SCORM API compatibility -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https: blob:; media-src 'self' blob: https:; frame-src 'self' https://www.youtube.com https://youtube.com https://www.youtube-nocookie.com; connect-src 'self'; font-src 'self' data:; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors *;">
    <title>{{course_title}}</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <!-- Alert Container -->
    <div id="scorm-alert-container"></div>
    
    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <div class="progress-circle-container">
                <svg class="progress-circle" width="100" height="100">
                    <circle class="progress-circle-bg" cx="50" cy="50" r="45" fill="none" stroke-width="6"/>
                    <circle class="progress-circle-fill" cx="50" cy="50" r="45" fill="none" stroke-width="6" 
                            stroke-linecap="round" transform="rotate(-90 50 50)"/>
                    <text class="progress-circle-text" x="50" y="50" text-anchor="middle" dy="7">0%</text>
                </svg>
                <div class="progress-label">Course Progress</div>
            </div>
        </div>
        
        <div class="sidebar-nav">
            <a href="#" class="nav-item active" data-page="welcome">Welcome</a>
            {{#if has_objectives}}
            <a href="#" class="nav-item" data-page="objectives">Learning Objectives</a>
            {{/if}}
            {{#each topics}}
            <a href="#" class="nav-item" data-page="{{this.id}}">{{this.title}}</a>
            {{/each}}
            <a href="#" class="nav-item" data-page="assessment">Assessment</a>
        </div>
    </nav>
    
    <!-- Main Content Area -->
    <main class="main-area">
        <!-- Fullscreen Toggle -->
        <button class="fullscreen-toggle" onclick="toggleFullscreen()">
            <span class="fullscreen-icon">⛶</span>
            <span class="exit-fullscreen-icon" style="display:none">✕</span>
        </button>
        
        <!-- Header -->
        <header class="header">
            <h1>{{course_title}}</h1>
        </header>
        
        <!-- Content Container -->
        <div id="content-container" class="content-container">
            <!-- Dynamic content loaded here -->
        </div>
        
        <!-- Footer Navigation -->
        <footer class="footer">
            <button id="prev-button" class="nav-button secondary" disabled>
                <span>←</span> Previous
            </button>
            
            <div class="nav-info">
                <!-- Optional: Add page counter or other info -->
            </div>
            
            <button id="next-button" class="nav-button primary">
                Next <span>→</span>
            </button>
        </footer>
    </main>
    
    <!-- SCORM API -->
    <script src="scripts/scorm_api.js"></script>
    
    <!-- Navigation System -->
    <script src="scripts/navigation.js"></script>
    
    <!-- Initialize SCORM -->
    <script>
        // Initialize SCORM connection
        if (window.API) {
            window.API.LMSInitialize("");
            console.log('[SCORM] Initialized connection to LMS');
        }
        
        // Handle window unload
        window.addEventListener('beforeunload', function() {
            if (window.API) {
                window.API.LMSFinish("");
            }
        });
        
        // Fullscreen toggle functionality
        function toggleFullscreen() {
            const elem = document.documentElement;
            const body = document.body;
            const fullscreenIcon = document.querySelector('.fullscreen-icon');
            const exitIcon = document.querySelector('.exit-fullscreen-icon');
            
            if (!document.fullscreenElement && !document.webkitFullscreenElement && 
                !document.mozFullScreenElement && !document.msFullscreenElement) {
                // Enter fullscreen
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen();
                } else if (elem.mozRequestFullScreen) {
                    elem.mozRequestFullScreen();
                } else if (elem.msRequestFullscreen) {
                    elem.msRequestFullscreen();
                }
                body.classList.add('fullscreen-mode');
                fullscreenIcon.style.display = 'none';
                exitIcon.style.display = 'inline';
            } else {
                // Exit fullscreen
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                body.classList.remove('fullscreen-mode');
                fullscreenIcon.style.display = 'inline';
                exitIcon.style.display = 'none';
            }
        }
        
        // Handle fullscreen change events
        document.addEventListener('fullscreenchange', handleFullscreenChange);
        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
        document.addEventListener('mozfullscreenchange', handleFullscreenChange);
        document.addEventListener('MSFullscreenChange', handleFullscreenChange);
        
        function handleFullscreenChange() {
            const body = document.body;
            const fullscreenIcon = document.querySelector('.fullscreen-icon');
            const exitIcon = document.querySelector('.exit-fullscreen-icon');
            
            if (!document.fullscreenElement && !document.webkitFullscreenElement && 
                !document.mozFullScreenElement && !document.msFullscreenElement) {
                body.classList.remove('fullscreen-mode');
                fullscreenIcon.style.display = 'inline';
                exitIcon.style.display = 'none';
            }
        }
    </script>
</body>
</html>